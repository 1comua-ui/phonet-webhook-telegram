# phonet-webhook-telegram
Clean Telegram notifications for Phonet.ua calls via WebHooks (no duplicates, FSM-based).

Webhook-based integration for **Phonet.ua** that sends clean, non-duplicated
informational call notifications to **Telegram**.

–ü—Ä–æ—î–∫—Ç –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó –ø–æ–¥—ñ–π (`call.dial`, `call.bridge`, `call.hangup`)
—É **—î–¥–∏–Ω–∏–π –ª–æ–≥—ñ—á–Ω–∏–π –¥–∑–≤—ñ–Ω–æ–∫** –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `parentUuid`
—Ç–∞ finite-state machine (FSM).

---

## üéØ –ú–µ—Ç–∞ –ø—Ä–æ—î–∫—Ç—É

- –û—Ç—Ä–∏–º—É–≤–∞—Ç–∏ **1 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—Ö—ñ–¥–Ω–∏–π –¥–∑–≤—ñ–Ω–æ–∫**
- –û—Ç—Ä–∏–º—É–≤–∞—Ç–∏ **1 —Ñ—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**:
  - ‚úÖ –¥–∑–≤—ñ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ (—è–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∏)
  - ‚ùå –¥–∑–≤—ñ–Ω–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–æ (—è–∫—â–æ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∏)
- ‚ùå –ë–µ–∑ –¥—É–±–ª—ñ–≤
- ‚ùå –ë–µ–∑ —Ñ–∞–ª—å—à–∏–≤–∏—Ö "–ø—Ä–æ–ø—É—â–µ–Ω–æ" –ø—Ä–∏ –∞–≤—Ç–æ–ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü—ñ—ó
- ‚ÑπÔ∏è Telegram –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–ª–∏—à–µ –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è**
- üß† –í—Å—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞, –∑–∞–ø–∏—Å–∏ —Ç–∞ AI-—Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ CRM

---

## üß† –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ (–∫–æ—Ä–æ—Ç–∫–æ)

- **Phonet WebHooks** ‚Üí HTTP POST
- **–û–¥–∏–Ω endpoint**, —Ç—Ä–∏ —Ç–∏–ø–∏ –ø–æ–¥—ñ–π:
  - `call.dial`
  - `call.bridge`
  - `call.hangup`
- **FSM** –∞–≥—Ä–µ–≥—É—î –ø–æ–¥—ñ—ó –ø–æ `parentUuid`
- **Telegram** –æ—Ç—Ä–∏–º—É—î –ª–∏—à–µ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π, –æ—á–∏—â–µ–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **Cron** –≥–∞—Ä–∞–Ω—Ç—É—î —Ñ—ñ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–∑–≤—ñ–Ω–∫—ñ–≤ –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ ‚Äú—Ç–∏—à—ñ‚Äù

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```text
public/
‚îî‚îÄ‚îÄ webhook/
    ‚îî‚îÄ‚îÄ phonet.php          # —î–¥–∏–Ω–∏–π web-–¥–æ—Å—Ç—É–ø–Ω–∏–π endpoint

src/
‚îú‚îÄ‚îÄ config.example.php      # –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ bootstrap.php           # —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ fsm.php                 # FSM –ª–æ–≥—ñ–∫–∞ –¥–∑–≤—ñ–Ω–∫—ñ–≤
‚îú‚îÄ‚îÄ telegram.php            # Telegram API
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îî‚îÄ‚îÄ phonet.sqlite       # SQLite (–ø–æ–∑–∞ web)
‚îî‚îÄ‚îÄ logs/
    ‚îú‚îÄ‚îÄ phonet.log
    ‚îú‚îÄ‚îÄ errors.log
    ‚îî‚îÄ‚îÄ cron.log

cron/
‚îú‚îÄ‚îÄ finalize_calls.php      # —Ñ—ñ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∑–≤—ñ–Ω–∫—ñ–≤
‚îî‚îÄ‚îÄ cleanup_calls.php       # —á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
